# Network IP Scanner - Cockpit Plugin

[中文版 README](README.zh-TW.md)

A [Cockpit](https://cockpit-project.org/) web console plugin for scanning and monitoring active devices on your local network.

![Vue 3](https://img.shields.io/badge/Vue-3-4FC08D?logo=vuedotjs)
![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-4-06B6D4?logo=tailwindcss)
![Cockpit](https://img.shields.io/badge/Cockpit-Plugin-0066CC)

![Screenshot](image.png)

## Features

- Auto-detect network interfaces and subnet calculation
- Active ping scan using `fping` (with `ping` fallback)
- MAC-based device deduplication (IPv4 + IPv6 same MAC = one device)
- State filter chips (Reachable / Stale) with color-coded status
- IPv4 / IPv6 protocol toggle
- Real-time search by IP, MAC, or state
- Scan progress bar with phase indicator
- LocalStorage cache for interface selection and scan results
- Auto-rescan when cached data is older than 5 minutes
- i18n support (English, Traditional Chinese) following Cockpit language setting

## Requirements

- Linux server with [Cockpit](https://cockpit-project.org/) installed
- Optional: `fping` for faster scanning

```bash
# Ubuntu / Debian
sudo apt install cockpit fping

# RHEL / Fedora
sudo dnf install cockpit fping
```

## Installation

The repository includes pre-built files via CI. No build step required.

```bash
git clone https://github.com/as6325400/ip-scanner.git
cd ip-scanner
sudo make install
```

Then open Cockpit in your browser (default: `https://<server-ip>:9090`) and find **Network IP Scanner** in the Tools section of the sidebar.

## Uninstall

```bash
sudo make uninstall
```

## Development

If you want to modify the source code:

```bash
# Install dependencies
npm install

# Dev server (hot reload)
npm run dev

# Production build
npm run build
```

### Project Structure

```
ip-scanner/
├── src/
│   ├── App.vue              # Main application component
│   ├── main.js              # Vue entry point
│   ├── style.css            # Tailwind CSS import
│   ├── i18n.js              # i18n module (locale detection + translation)
│   └── locales/
│       ├── en.json           # English translations
│       └── zh-TW.json        # Traditional Chinese translations
├── dist/
│   └── index.html            # Built single-file output (auto-generated by CI)
├── po.manifest.zh_TW.js      # Cockpit sidebar label translation
├── manifest.json              # Cockpit plugin manifest
├── index.html                 # Vite entry HTML
├── vite.config.js             # Vite + Tailwind + SingleFile config
├── Makefile                   # install / uninstall targets
└── .github/workflows/
    └── build.yml              # CI: auto-build on push
```

### How It Works

1. **Interface Detection**: Uses `ip -j link` / `ip -j addr` via `cockpit.spawn()` to list active network interfaces and calculate subnets.
2. **Scanning**: Runs `fping -a -g <subnet>` to ping all hosts in the subnet. Falls back to a parallel `ping` loop if `fping` is not installed.
3. **Neighbor Collection**: After a 2-second settling delay, reads the ARP/NDP table with `ip -j neigh show dev <iface>` and groups entries by MAC address.
4. **Caching**: Stores scan results in `localStorage`. On page reload, restores cached data and auto-rescans if the cache is older than 5 minutes.
5. **i18n**: Detects language from `CockpitLang` cookie > `cockpit.language` > `navigator.language`, with English as fallback.

## Tech Stack

- [Vue 3](https://vuejs.org/) (Composition API, `<script setup>`)
- [Tailwind CSS 4](https://tailwindcss.com/)
- [Vite](https://vite.dev/)
- [vite-plugin-singlefile](https://github.com/niccoloraspa/vite-plugin-singlefile) (inline all JS/CSS into one HTML)

## License

MIT
